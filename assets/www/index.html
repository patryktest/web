<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>WebSockets - Simple chat</title>


</head>
<body>

<span id="status">Connecting...</span>

 <script type="text/javascript" src="cordova.js"></script>
 <script src="./js/jquery.min.js"></script>
<script type="text/javascript">
/*function onLoad(){
	//document.addEventListener("deviceready", onDeviceReady, true);
	connect();
};*/
 $(function () {
	document.addEventListener("deviceready", onDeviceReady, true);
	//connect();
});
function onDeviceReady()
{
	connect();
}
function connect(){
	content = $('#status');
	content.append('brrr <br>');
    // if user is running mozilla then use it's built-in WebSocket
    window.WebSocket = window.WebSocket || window.MozWebSocket;

    var connection = new WebSocket('ws://demo-project.patryktesting.c9.io');

    connection.onopen = function () {
        alert('connected');
    };

    connection.onerror = function (error) {
        // an error occurred when sending/receiving data
		alert(error);
    };

    connection.onmessage = function (message) {
        // try to decode json (I assume that each message from server is json)
        try {
            var json = JSON.parse(message.data);
        } catch (e) {
            console.log('This doesn\'t look like a valid JSON: ', message.data);
            return;
        }
		
		if(json.type === 'message'){
			addMessage(json.data);
		}
        // handle incoming message
    };
	
	function addMessage(message){
		content.append(message+'<br>');
	}
}
</script>
</body>
</html>